databaseChangeLog:
  - changeSet:
      id: create-sequence
      author: mike
      changes:
        - createSequence:
            cacheSize: 1
            cycle: false
            dataType: int8
            incrementBy: 1
            sequenceName: hibernate_sequence
            startValue: 1
  - changeSet:
      id: init-tables
      author: mike
#      preConditions:
#        - onFail: MARK_RAN
#          not:
#            - tableExists:
#                tableName: products
      changes:
        - createTable:
              tableName: groups
              columns:
                - column:
                    autoIncrement: true
                    constraints:
                      nullable: false
                      primaryKey: true
                    name: id
                    type: int8
                - column:
                    name: group_name
                    type: varchar(255)
        - createTable:
            tableName: products
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  name: name
                  type: varchar(255)
              - column:
                  name: price
                  type: float8
              - column:
                  constraints:
                    foreignKeyName: prod_group_fkey
                    references: groups(id)
                  name: group_id
                  type: int8
        - createTable:
            tableName: prod_count
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  constraints:
                    foreignKeyName: count_prod_fkey
                    references: products(id)
                  name: prod_id
                  type: int8
              - column:
                  name: count
                  type: int4
        - createTable:
            tableName: checks
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  name: date
                  type: timestamp
              - column:
                  name: description
                  type: varchar(255)
              - column:
                  name: total_sum
                  type: float8
        - createTable:
            tableName: cancellations
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  name: date
                  type: timestamp
              - column:
                  name: reason
                  type: varchar(255)
        - createTable:
            tableName: operations
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  name: prod_amount
                  type: int4
              - column:
                  name: operation
                  type: varchar(255)
              - column:
                  name: sum
                  type: float8
              - column:
                  constraints:
                    foreignKeyName: oper_cancellation_fkey
                    references: cancellations(id)
                  name: cancellation_id
                  type: int8
              - column:
                  constraints:
                    foreignKeyName: oper_check_fkey
                    references: checks(id)
                  name: check_id
                  type: int8
              - column:
                  constraints:
                    foreignKeyName: oper_prod_fkey
                    references: products(id)
                  name: prod_id
                  type: int8
  - changeSet:
      id: alter-table-invoices
      author: mike
      changes:
        - createTable:
            tableName: invoices
            columns:
              - column:
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
                  name: id
                  type: int8
              - column:
                  name: product_name
                  type: varchar(255)
              - column:
                  name: count
                  type: int4
              - column:
                  name: price
                  type: float8
              - column:
                  name: sum
                  type: float8
  - changeSet:
      id: add-column-invoices
      author: mike
      changes:
        - addColumn:
            tableName: invoices
            columns:
              - column:
                  constraints:
                    foreignKeyName: invoice_group_fkey
                    references: groups(id)
                  name: group_id
                  type: int8
  - changeSet:
      id: add-column-checks
      author: mike
      changes:
        - addColumn:
            tableName: checks
            columns:
              - column:
                  name: closed
                  type: bool
  - changeSet:
      id : remove-table-cancellations
      author: mike
      changes:
#        - renameColumn:
#            tableName: prod_amount
#            oldColumnName: amount
#            newColumnName: count
#        - renameTable:
#            oldTableName: prod_amount
#            newTableName: prod_count
        - dropForeignKeyConstraint:
            baseTableName: operations
            constraintName: oper_cancellation_fkey
        - dropTable:
            tableName: cancellations
        - dropColumn:
            tableName: operations
            columnName: cancellation_id